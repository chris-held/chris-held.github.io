<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Theremin</title>
    <style>
        body, html {
            height: 100%;
            cursor: pointer;
            overflow: hidden;
            background: #B24592; /* fallback for old browsers */
            background: -webkit-linear-gradient(to bottom, #B24592 , #F15F79); /* Chrome 10-25, Safari 5.1-6 */
            background: linear-gradient(to bottom, #B24592 , #F15F79); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
        }
    </style>
</head>
<body>
<script>
    (function(){
        var context = new AudioContext(),
                gainNode = context.createGain(),
                circle = document.querySelector('#circle'),
                mousedown = false,
                oscillator = null;

        gainNode.connect(context.destination);

        var calculateFrequency = function (mouseXPosition) {
            var minFrequency = 20,
                    maxFrequency = 2000;

            return ((mouseXPosition / window.innerWidth) * maxFrequency) + minFrequency;
        };

        var calculateGain = function (mouseYPosition) {
            var minGain = 0,
                    maxGain = 1;

            return 1 - ((mouseYPosition / window.innerHeight) * maxGain) + minGain;
        };

        var createOscillator = function (e) {
            var xPos = e.clientX,
                    yPos = e.clientY;

            if (e.touches) {
                xPos = e.touches[0].clientX;
                yPos = e.touches[0].clientY;
            }

            mousedown = true;

            oscillator = context.createOscillator();
            oscillator.frequency.setTargetAtTime(calculateFrequency(xPos), context.currentTime, 0.001);
            gainNode.gain.setTargetAtTime(calculateGain(yPos), context.currentTime, 0.001);
            oscillator.connect(gainNode);
            oscillator.start(context.currentTime);
        };

        var stopOscillator = function () {
            mousedown = false;

            if (oscillator) {
                oscillator.stop(context.currentTime);
                oscillator.disconnect();
            }
        };

        var changeFrequency = function (e) {
            var xPos = e.clientX,
                    yPos = e.clientY;

            if (e.touches) {
                xPos = e.touches[0].clientX;
                yPos = e.touches[0].clientY;
            }

            if (mousedown && oscillator) {
                oscillator.frequency.setTargetAtTime(calculateFrequency(xPos), context.currentTime , 0.001);
                gainNode.gain.setTargetAtTime(calculateGain(yPos), context.currentTime, 0.001);

                drawCircle(xPos, yPos);
            }
        };

        document.body.addEventListener('mousedown', function (e) {
            createOscillator(e);
        });

        document.body.addEventListener('touchstart', function (e) {
            createOscillator(e);
        });

        document.body.addEventListener('mouseup', function () {
            stopOscillator();
        });

        document.body.addEventListener('touchend', function () {
            stopOscillator();
        });

        document.body.addEventListener('mousemove', function (e) {
            changeFrequency(e);
        });

        document.body.addEventListener('touchmove', function (e) {
            changeFrequency(e);
        });
    })();
</script>
</body>
</html>